# 통합 테스트
## 테스트 대상 상세
- Bookking 어플리케이션 API 서버의 통합 호출 테스트
- Elasticsearch, 외부 OpenAPI 등 외부 연동 시스템이 정상 동작하는지 확인
- 전체 API 흐름이 문제 없이 연결되고 작동하는지 점검하는 통합 기능 테스트

## 테스트 시나리오 목적
- 북킹 어플리케이션의 API 서버와 연결된 Elasticsearch, OpenAPI 연동이 정상적으로 작동하는지 확인하고,<br>
전체 어플리케이션 흐름이 장애 없이 작동하는지 엔드 투 엔드(End-to-End) 방식으로 검증하기 위함.

## 가정 및 필요 조건
테스트 환경 구성:
- mysql → DB
- elastic search → ES
- redis → 세션 및 캐시 저장소
- application → app
- 위 4개 요소는 모두 1개 인스턴스씩 기동된 상태에서 테스트를 수행
- 요청 Body는 모두 JSON 타입
- 기본 요청 주소 (baseURL): https://app.tomorrowlearncamp.xyz

## 테스트 시나리오 목록
| 번호 | 대분류           | 시나리오 요약                  | 요청 방식 및 엔드포인트                                      | 테스트 단계 요약                       | 기댓값 또는 응답 예시                                    |
| -- | ------------- | ------------------------ | -------------------------------------------------- | ------------------------------- | ----------------------------------------------- |
| 1  | 회원가입          | 중복되지 않은 이메일로 회원가입 시도     | POST `/api/v1/auth/signup`                         | POST → 중복검증 → DB저장 → 201 응답     | `{ "userId": 1, "email": "test12@google.com" }` |
| 2  | 로그인           | 가입된 계정으로 로그인 시도          | POST `/api/v1/auth/login`                          | POST → 유저/비밀번호 검증 → JWT 발급      | accessToken, refreshToken 반환                    |
| 3  | 리프레시 토큰       | 만료된 accessToken으로 재발급 요청 | POST `/api/v1/auth/refresh`                        | POST → 만료 확인 → refresh 검증 → 재발급 | HTTP 200 OK + 토큰                                |
| 4  | 유저 정보 조회      | 로그인한 사용자의 정보 요청          | POST `/api/v1/users/myInfo`                        | POST → 인증 → DB 조회               | HTTP 200 OK + JSON                              |
| 5  | 정보 수정         | 로그인한 사용자의 정보 수정          | PATCH `/api/v1/users/myInfo`                       | PATCH → 인증 → 수정 및 DB 반영         | HTTP 200 OK                                     |
| 6  | 권한 변경         | 어드민이 다른 유저 권한 변경         | PATCH `/api/v1/users/{userId}/role`                | 권한 검증 → 유저 검증 → 권한 수정 → DB 저장   | HTTP 200 OK                                     |
| 7  | 회원 탈퇴         | 로그인한 유저가 회원 탈퇴 요청        | DELETE `/api/v1/users/{userId}`                    | DELETE → 비밀번호 검증 → 탈퇴 처리        | HTTP 200 OK                                     |
| 8  | 책 검색(OpenAPI) | 외부 API를 통해 책 검색          | POST `/api/v1/books/search`                        | POST → WebClient → 외부 API 요청    | HTTP 200 OK + JSON                              |
| 9  | 책 등록          | OpenAPI로 책 DB에 저장        | POST `/api/v1/books/import`                        | param 포함 POST → 순차 저장           | HTTP 200 OK                                     |
| 10 | 책 수정          | 어드민이 책 데이터 수정            | PATCH `/api/v1/books/{bookId}`                     | PATCH → 수정 → DB 반영              | HTTP 200 OK                                     |
| 11 | 책 재고 수정       | 어드민이 책 수량 변경             | PATCH `/api/v1/books/{bookId}/stock`               | PATCH → 재고 수정 → DB 반영           | HTTP 200 OK                                     |
| 12 | 책 삭제          | 어드민이 책 삭제                | DELETE `/api/v1/books/{bookId}`                    | DELETE → DB 삭제                  | HTTP 200 OK                                     |
| 13 | 책 목록 조회       | 유저가 페이징된 책 목록 조회         | GET `/api/v1/books`                                | GET + param → DB 조회             | HTTP 200 OK + JSON                              |
| 14 | 책 단건 조회       | 유저가 특정 책 정보 조회           | GET `/api/v1/books/{bookId}`                       | GET + path → DB 조회              | HTTP 200 OK + JSON                              |
| 15 | 키워드 검색(ES)    | ES로 키워드 검색               | GET `/api/v1/elasticsearch?keyword=`               | GET + keyword → ES 검색           | HTTP 200 OK + JSON                              |
| 16 | 자동완성(ES)      | 키워드 자동완성 검색              | GET `/api/v3/elasticsearch/autocomplete`           | GET + param → ES 검색             | HTTP 200 OK + JSON                              |
| 17 | 연관검색어(ES)     | 키워드 연관 검색                | GET `/api/v3/elasticsearch/relate`                 | GET + param → 연관어 반환            | HTTP 200 OK + JSON                              |
| 18 | 주문 내역 조회      | 유저의 주문 이력 조회             | GET `/api/v1/orders/myinfo`                        | GET + param → DB 조회             | HTTP 200 OK + JSON                              |
| 19 | 책 주문          | 유저가 책을 구매                | POST `/api/v1/payments`                            | POST → 락 획득 → 검증 → 결제 처리        | HTTP 200 OK + JSON                              |
| 20 | 주문 취소         | 유저가 주문한 책 취소             | DELETE `/api/v1/payments`                          | DELETE → 락 획득 → 환불 처리           | HTTP 200 OK + JSON                              |
| 21 | 리뷰 작성         | 구매한 책에 대한 리뷰 작성          | POST `/api/v1/books/{bookId}/reviews`              | POST → 검증 → 리뷰 저장               | HTTP 200 OK + JSON                              |
| 22 | 리뷰 목록 조회      | 책의 리뷰 전체 조회              | GET `/api/v1/books/{bookId}/reviews`               | GET → DB 조회                     | HTTP 200 OK + JSON                              |
| 23 | 리뷰 수정         | 작성한 리뷰 수정                | PATCH `/api/v1/books/{bookId}/reviews/{reviewId}`  | PATCH → 검증 → 수정                 | HTTP 200 OK                                     |
| 24 | 리뷰 삭제         | 작성한 리뷰 삭제                | DELETE `/api/v1/books/{bookId}/reviews/{reviewId}` | DELETE → 검증 → 삭제                | HTTP 200 OK                                     |
| 25 | 내 리뷰 조회       | 유저가 작성한 리뷰 전체 조회         | GET `/api/v1/review/myinfo`                        | GET → DB 조회                     | HTTP 200 OK + JSON                              |
| 26 | 키워드 추천        | 입력 키워드 기반 외부 추천          | POST `/api/v1/keywords/suggest`                    | POST → 외부 API 요청                | HTTP 200 OK + JSON                              |
| 27 | 구매 기반 추천      | 구매 이력을 활용한 키워드 추천        | GET `/api/v1/keywords/recommendations`             | GET → DB + 외부 API 조회            | HTTP 200 OK + JSON                              |
